import streamlit as st
import google.generativeai as genai

# --- è¨­å®šé é¢è³‡è¨Š ---
st.set_page_config(page_title="24å°æ™‚æ•¸ä½åˆç´„å¾‹å¸«", page_icon="âš–ï¸")

st.title("âš–ï¸ ä½ çš„ 24 å°æ™‚å£è¢‹æ•¸ä½åˆç´„å¾‹å¸«")
st.markdown("åˆ¥è®“åˆç´„æˆç‚ºçœ‹ä¸æ‡‚çš„å¤©æ›¸ã€‚æˆ‘å€‘çš„ AI é˜²è­·ç½©ç‚ºä½ é åˆ¤é¢¨éšªï¼Œåƒç´…ç¶ ç‡ˆä¸€æ¨£æ¨™ç¤ºé™·é˜±ï¼Œå®ˆè­·ä½ çš„å®‰å¿ƒã€‚")

# --- å´é‚Šæ¬„ï¼šè¨­å®š API Key ---
with st.sidebar:
    st.header("ğŸ”‘ å•Ÿå‹•é‡‘é‘°")
    api_key = st.text_input("è«‹è¼¸å…¥ Google API Key", type="password")
    st.info("è«‹å°‡å‰›å‰›ç”³è«‹çš„ Key è²¼åœ¨é€™è£¡ï¼ŒæŒ‰ä¸‹ Enter å³å¯é–‹å§‹ä½¿ç”¨ã€‚")

# --- ä¸»ç¨‹å¼é‚è¼¯ ---
if api_key:
    try:
        # è¨­å®š Google Gemini
        genai.configure(api_key=api_key)
        model = genai.GenerativeModel('gemini-pro') # ä½¿ç”¨è¼ƒå¼·çš„æ¨¡å‹ä¾†åˆ†æåˆç´„

        # è®“ä½¿ç”¨è€…è¼¸å…¥åˆç´„å…§å®¹
        contract_content = st.text_area("ğŸ“„ è«‹å°‡åˆç´„å…§å®¹è²¼åœ¨é€™è£¡ï¼š", height=300)

        # è¨­å®š AI çš„è§’è‰² (é€™è£¡å°±æ˜¯ä½ çš„ã€Œç§˜æ–¹ã€)
        system_prompt = """
        ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„å°ç£å¾‹å¸«ï¼Œå°ˆç²¾æ–¼ç§Ÿè³ƒèˆ‡ä¸€èˆ¬æ°‘äº‹åˆç´„ã€‚
        è«‹å¹«æˆ‘åˆ†æä½¿ç”¨è€…æä¾›çš„åˆç´„å…§å®¹ã€‚
        è«‹ä¾ç…§ä»¥ä¸‹æ ¼å¼è¼¸å‡ºåˆ†æçµæœï¼š
        1. **ğŸš¦ æ•´é«”é¢¨éšªè©•ä¼°**ï¼šçµ¦äºˆ ç´…ç‡ˆ(å±éšª)/é»ƒç‡ˆ(æ³¨æ„)/ç¶ ç‡ˆ(å®‰å…¨) çš„è©•ç´šã€‚
        2. **âš ï¸ é—œéµé¢¨éšªæ¢æ¬¾**ï¼šåˆ—å‡ºå°ä½¿ç”¨è€…æœ€ä¸åˆ©çš„ 3-5 å€‹æ¢æ¬¾ï¼Œä¸¦è§£é‡‹ç‚ºä»€éº¼å±éšªã€‚
        3. **ğŸ›¡ï¸ ä¿®æ”¹å»ºè­°**ï¼šé‡å°ä¸Šè¿°é¢¨éšªï¼Œæä¾›å…·é«”çš„ä¿®æ”¹æˆ–è«‡åˆ¤å»ºè­°ã€‚
        4. **ğŸ’¡ éš±è—é™·é˜±**ï¼šæŒ‡å‡ºåˆç´„ä¸­ã€Œæ²’å¯«å‡ºä¾†ã€ä½†æ‡‰è©²è¦æœ‰çš„æ¬Šç›Šï¼ˆä¾‹å¦‚ï¼šè‡ªç„¶æè€—å®šç¾©ã€æå‰è§£ç´„æ¢æ¬¾ï¼‰ã€‚
        """

        if st.button("ğŸš€ å•Ÿå‹•æ•¸ä½é˜²è­·ç½© (é–‹å§‹åˆ†æ)"):
            if contract_content:
                with st.spinner("âš–ï¸ å¾‹å¸«æ­£åœ¨é€æ¢å¯©é–±æ‚¨çš„åˆç´„ï¼Œè«‹ç¨å€™..."):
                    # çµ„åˆæç¤ºè©
                    full_prompt = f"{system_prompt}\n\nä»¥ä¸‹æ˜¯åˆç´„å…§å®¹ï¼š\n{contract_content}"
                    
                    # ç™¼é€çµ¦ AI
                    response = model.generate_content(full_prompt)
                    
                    # é¡¯ç¤ºçµæœ
                    st.divider()
                    st.subheader("ğŸ“Š åˆ†æå ±å‘Š")
                    st.markdown(response.text)
            else:
                st.warning("è«‹å…ˆè²¼ä¸Šåˆç´„å…§å®¹å–”ï¼")

    except Exception as e:
        st.error(f"ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ API Key æ˜¯å¦æ­£ç¢ºã€‚\néŒ¯èª¤è¨Šæ¯: {e}")
else:
    st.warning("ğŸ‘ˆ è«‹å…ˆåœ¨å·¦å´æ¬„ä½è¼¸å…¥ API Key æ‰èƒ½å•Ÿç”¨å¾‹å¸«æœå‹™ã€‚")

